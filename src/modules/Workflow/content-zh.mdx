# 数据分析工作流程

## 概述

数据分析工作流程是数据分析项目的核心框架，涵盖了从数据收集到结果展示的完整过程。本模块将详细介绍数据分析的四个关键阶段，帮助您建立系统性的分析思维和方法。

## 完整数据分析工作流示例

通过实际代码示例了解完整的数据分析流程：

```python
# 完整数据分析工作流示例
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix

print("=== 完整数据分析工作流 ===")

# 1. 数据收集阶段
print("\n1. 数据收集阶段")
print("加载电商用户行为数据...")

# 模拟数据加载
data = {
    'user_id': range(1, 1001),
    'age': np.random.randint(18, 65, 1000),
    'gender': np.random.choice(['M', 'F'], 1000),
    'session_duration': np.random.normal(300, 100, 1000),
    'page_views': np.random.poisson(5, 1000),
    'purchase_amount': np.random.exponential(50, 1000),
    'is_purchased': np.random.choice([0, 1], 1000, p=[0.7, 0.3])
}

df = pd.DataFrame(data)
print(f"数据形状: {df.shape}")
print(f"数据概览:")
print(df.head())

# 2. 数据处理阶段
print("\n2. 数据处理阶段")
print("数据清洗和预处理...")

# 处理异常值
df = df[df['session_duration'] > 0]
df = df[df['page_views'] >= 0]
df = df[df['purchase_amount'] >= 0]

# 创建新特征
df['avg_time_per_page'] = df['session_duration'] / df['page_views']
df['high_value_user'] = (df['purchase_amount'] > df['purchase_amount'].quantile(0.8)).astype(int)

print(f"处理后数据形状: {df.shape}")
print("新特征创建完成")

# 3. 数据分析阶段
print("\n3. 数据分析阶段")
print("建立用户购买行为预测模型...")

# 准备特征和目标变量
features = ['age', 'session_duration', 'page_views', 'avg_time_per_page']
X = df[features]
y = df['is_purchased']

# 分割数据
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 训练模型
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# 预测和评估
y_pred = model.predict(X_test)
print("\n模型性能评估:")
print(classification_report(y_test, y_pred))

# 特征重要性
feature_importance = pd.DataFrame({
    'feature': features,
    'importance': model.feature_importances_
}).sort_values('importance', ascending=False)

print("\n特征重要性:")
print(feature_importance)

# 4. 结果展示阶段
print("\n4. 结果展示阶段")
print("生成分析报告和可视化...")

# 创建可视化
fig, axes = plt.subplots(2, 2, figsize=(15, 10))
fig.suptitle('电商用户行为分析报告', fontsize=16)

# 用户年龄分布
axes[0, 0].hist(df['age'], bins=20, alpha=0.7, color='skyblue')
axes[0, 0].set_title('用户年龄分布')
axes[0, 0].set_xlabel('年龄')
axes[0, 0].set_ylabel('用户数量')

# 购买行为对比
purchase_by_gender = df.groupby('gender')['is_purchased'].mean()
axes[0, 1].bar(purchase_by_gender.index, purchase_by_gender.values, color=['lightcoral', 'lightblue'])
axes[0, 1].set_title('性别购买率对比')
axes[0, 1].set_ylabel('购买率')

# 会话时长与购买关系
axes[1, 0].scatter(df['session_duration'], df['purchase_amount'], alpha=0.6)
axes[1, 0].set_title('会话时长与购买金额关系')
axes[1, 0].set_xlabel('会话时长(秒)')
axes[1, 0].set_ylabel('购买金额')

# 特征重要性
axes[1, 1].barh(feature_importance['feature'], feature_importance['importance'])
axes[1, 1].set_title('特征重要性')
axes[1, 1].set_xlabel('重要性')

plt.tight_layout()
plt.show()

# 5. 业务洞察和建议
print("\n=== 业务洞察和建议 ===")
print(f"总用户数: {len(df)}")
print(f"购买用户比例: {df['is_purchased'].mean():.2%}")
print(f"平均购买金额: {df[df['is_purchased']==1]['purchase_amount'].mean():.2f}")
print(f"平均会话时长: {df['session_duration'].mean():.2f}秒")

print("\n关键发现:")
print("1. 会话时长是影响购买决策的重要因素")
print("2. 页面浏览数与购买概率呈正相关")
print("3. 年龄分布相对均匀，无明显年龄偏好")
print("4. 性别对购买行为有一定影响")

print("\n行动建议:")
print("1. 优化页面加载速度，延长用户会话时长")
print("2. 改进页面内容，增加页面浏览量")
print("3. 针对不同性别用户制定差异化营销策略")
print("4. 建立用户行为预测模型，实现精准营销")

print("\n=== 分析完成 ===")
```

## 学习目标

通过本模块的学习，您将能够：

- **掌握完整流程**：了解数据分析项目的完整生命周期
- **数据收集技能**：学会从各种数据源获取和初步探索数据
- **数据处理能力**：掌握数据清洗、转换和特征工程
- **分析建模技术**：学会统计分析和机器学习建模
- **结果展示技巧**：能够有效展示和解释分析结果

## 核心内容

### 1. 数据收集阶段

数据分析的第一步，包括：

- **数据获取**：从数据库、API、文件等获取数据
- **数据概览**：了解数据的基本信息和结构
- **质量评估**：检查数据的完整性和准确性
- **初步探索**：通过统计和可视化了解数据特征

### 2. 数据处理阶段

为分析做准备的数据预处理：

- **数据清洗**：处理缺失值、异常值和重复值
- **数据转换**：类型转换、标准化、归一化
- **特征工程**：创建新特征和变量
- **数据分割**：训练集、测试集划分

### 3. 数据分析阶段

项目的核心环节：

- **描述性分析**：统计摘要和分布分析
- **探索性分析**：变量关系和相关分析
- **建模分析**：建立预测模型和分类模型
- **模型评估**：性能评估和结果验证

### 4. 结果展示阶段

确保分析结果有效传达：

- **数据可视化**：创建清晰的图表和仪表板
- **报告撰写**：结构化分析报告
- **结果解释**：业务含义和洞察
- **行动建议**：基于分析结果的建议

## 实践案例

电商用户行为分析项目：

1. **数据收集**：获取电商用户行为数据
2. **数据处理**：清洗和预处理用户数据
3. **数据分析**：建立用户购买行为预测模型
4. **结果展示**：生成分析报告和可视化

## 电商用户行为数据预览

| 用户ID | 年龄 | 性别 | 会话时长 | 页面浏览 | 购买金额 | 是否购买 |
|--------|------|------|----------|----------|----------|----------|
| U001 | 28 | F | 320 | 8 | 299 | 是 |
| U002 | 35 | M | 180 | 3 | 0 | 否 |
| U003 | 42 | F | 450 | 12 | 599 | 是 |
| U004 | 25 | M | 120 | 2 | 0 | 否 |
| U005 | 38 | F | 380 | 9 | 199 | 是 |

## 学习路径

1. **概览**：了解完整数据分析工作流程
2. **数据收集**：学习数据获取和初步探索
3. **数据处理**：掌握数据清洗和预处理技术
4. **数据分析**：学会统计分析和建模方法
5. **结果展示**：掌握可视化和报告技巧

## 关键技能

- 数据收集和探索
- 数据清洗和预处理
- 统计分析和建模
- 结果可视化和解释

## 学习建议

- **项目导向**：通过完整项目学习工作流程
- **实践为主**：每个阶段都要动手实践
- **业务思维**：关注业务价值和实际应用
- **工具熟练**：熟练掌握各种分析工具

---

*掌握完整的数据分析工作流程将为您的数据分析职业生涯奠定坚实基础。*
